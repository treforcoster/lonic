import isFunction from '@roots/bud-support/lodash/isFunction';
/**
 * Gracefully shutdown {@link Bud} and registered {@link Services}
 *
 * @example
 * ```js
 * bud.close()
 * ```
 */
export function close(onComplete) {
    const application = this;
    try {
        if (application.compiler?.instance?.running) {
            application.compiler.instance.close(() => {
                closeDevelopmentServer(application);
            });
        }
        else {
            closeDevelopmentServer(application);
        }
    }
    catch (error) {
        throw error;
    }
    if (onComplete)
        return onComplete();
}
const closeDevelopmentServer = (application) => {
    try {
        if (application.isDevelopment &&
            isFunction(application.server?.watcher?.instance?.close)) {
            application.server.watcher.instance.close();
            application.success(`closed fs watch`);
        }
        if (application.isDevelopment &&
            isFunction(application.server?.connection?.instance?.close)) {
            application.server.connection.instance.close();
            application.success(`closed development server`);
        }
    }
    catch (error) {
        throw error;
    }
};
//# sourceMappingURL=close.js.map